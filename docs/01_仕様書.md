# 外部仕様（ユーザー向け仕様）

## 概要

- 本アプリは「ポケモンユナイトの3BANドラフト」を体験できるデモアプリです。
- 1人プレイ（ローカル）/2人プレイ（オンライン）に対応します。
- 2人プレイでは、双方の操作がリアルタイムで画面に反映されます。

## プレイモード

- 1人プレイ（ローカル）
  - 1画面で両チームを操作する練習用モード。
- 2人プレイ（オンライン）
  - ロビーで部屋を作成し、URL共有で相手を招待します。
  - 両者が着席後、ホストのみ「ドラフト開始」できます。

## 画面構成

- Home
  - 1人/2人モードの選択。
- Lobby（2人プレイ）
  - 部屋ID/URLの表示とコピー。
  - 紫/橙の席に着席（表示名の入力が必要）。
  - 両席が着席済みかつ自分がホストのとき「ドラフト開始」ボタンが有効。
- Draft（ドラフト進行画面）
  - 左: 紫チームのBAN/PICK欄、右: 橙チームのBAN/PICK欄。
  - 中央: 現在フェーズ、残り時間（秒）、候補グリッド、決定ボタン。
  - 現在ターンのスロットをハイライト表示します。

## 用語

- BAN: 使用禁止ポケモンの指定。
- PICK: 試合で使用するポケモンの選択。
- 紫/橙: 2つの対戦チームの呼称。
- ターン: BAN または PICK の操作単位。

## ドラフトの進行（順序と入力個数）

- 使用禁止フェーズ1（ban1）
  - 1: 紫 BAN ×1
  - 2: 橙 BAN ×1
  - 3: 紫 BAN ×1
  - 4: 橙 BAN ×1
- 使用ポケモン選択フェーズ1（pick1）
  - 5: 紫 PICK ×1
  - 6: 橙 PICK ×2（同時ペア）
  - 7: 紫 PICK ×2（同時ペア）
  - 8: 橙 PICK ×1
- 使用禁止フェーズ2（ban2）
  - 9: 紫 BAN ×1
  - 10: 橙 BAN ×1
- 使用ポケモン選択フェーズ2（pick2）
  - 11: 橙 PICK ×1
  - 12: 紫 PICK ×2（同時ペア）
  - 13: 橙 PICK ×1（最終）
- すべて完了するとドラフトは終了（finished）。

## 操作ルール

- 重複禁止: BAN済み/いずれかのチームでPICK済みのポケモンは選択不可。
- 自分のターン以外は操作不可:
  - 候補グリッドはグレーアウト（クリック不可）。
  - 決定ボタンも無効化。
- 同時PICK（ペア）のターンでは、2体選択したときのみ決定可能。

## タイマーと自動確定

- ターン制限時間: デフォルト15秒（画面に残秒表示）。
- クライアント優先（0秒時の自動送信）
  - 0秒に達し、かつ自分のターンの場合のみ自動送信します。
  - 事前に選択済みがあればそれを確定、未選択なら「選択可能な候補」からランダム確定。
- サーバフォールバック（2秒猶予）
  - 0秒後、追加で2秒待っても確定が届かない場合、サーバ側が候補から自動選択して確定。
  - 以降、次ターンへ進行（以降も同様）。
- 残秒は目安表示（正はサーバ基準）。2秒の猶予内にクライアントの確定が到達すれば、そちらが優先されます。

## ハイライト表示

- 現在ターンで指定すべき BAN/PICK スロットを明示します。
- 同時PICKでは該当する2枠を同時にハイライトします。

## 候補グリッド

- タイプ別フィルタで絞込可能。
- 禁止/確定済みの候補には「禁止」表示を付けます。
- 2人プレイ時に相手ターンでは、全候補がグレーアウトしてクリック不可。

## ロビー（2人プレイ）

- 部屋作成
  - ホストが部屋を作ると部屋URLが生成され、共有できます。
- 着席
  - 紫/橙の席に着席（表示名が必要）。
  - 同一ユーザーは両席に着席できません。
- ドラフト開始
  - 両席が着席済み、かつホストのみ開始可能。
- 進行
  - 両者の画面がリアルタイムに同期（BAN/PICK結果、残秒、ターン）。

## URLと遷移

- 2人プレイの部屋URL: `?mode=2p&roomId=<ID>`
- 直接URLアクセスでロビーに接続、購読開始。
- ドラフト開始後はモーダルが閉じ、ドラフト画面に移行します。

## 既定値

- ターン制限時間: 15秒
- サーバフォールバック猶予: 2秒
- チームごとの BAN 数: 3
- チームごとの PICK 数: 5

## 制限事項（現時点）

- 観戦者モードは未提供。
- 途中離脱時の復帰は簡易（対戦相手の操作/サーバフォールバックに依存）。
- 残秒はクライアント計算のため、若干の表示ズレは許容されます。

## 参考

- ドラフト開始までの流れ（シーケンス）: `docs/sequence_01_ロビー作成_ドラフト開始.md`
- 1ターン目の進行（シーケンス）: `docs/sequence_02_ドラフト1ターン目.md`
